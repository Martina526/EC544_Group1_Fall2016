<!DOCTYPE html>
<html lang="en">
<head>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>
<script src="js/jquery-2.1.4.js"></script>
<script src="js/main.js"></script> <!-- Resource jQuery -->   
<link href = "static/source.css" rel = "stylesheet">
    
    
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="css/reset.css"> <!-- CSS reset -->
<link rel="stylesheet" href="css/style.css"> <!-- Resource style -->
<script src="js/modernizr.js"></script> <!-- Modernizr -->    
    <title>real_time_data</title>
</head>
<body>  
    <div id="wrapper" style = "">
        <div id="info">
        <div align = "center"><h1>Real-time Data</h1></div>
        <div id = "container" style = " width : 750px; height : 400px;  margin-left: 200px; margin-top:50px" > 
        </div>
            
        <script type="text/javascript">
            var y= null , 
                y1 = null, 
                y2 = null,
                y3 = null ;
            var url ="http://localhost:3000/api/realtime/" + new Date();
            //alert(1);
            $.getJSON(url, callback_realtime);

            function callback_realtime(rows){

                //alert(rows);

                var row = rows[0]['data'].split(",");
                var maxtemp = 0, mintemp = 25;
                //alert(row);
                for(var index = 0; index < row.length; index++){
                    
                    var data = row[index].split(":");
                    //alert(data);
                    switch(data[0]){
                            case('avg'): {
                                y = parseFloat(data[1]);
                                mintemp = Math.min(mintemp, y);
                                maxtemp = Math.max(maxtemp,y);
                            }
                            case('sensor_1'): {
                                y1 = parseFloat(data[1]);
                                mintemp = Math.min(mintemp, y1);
                                maxtemp = Math.max(maxtemp,y1);
                            }
                            case('sensor_2'): {
                                y2 = parseFloat(data[1]);
                                mintemp = Math.min(mintemp, y2);
                                maxtemp = Math.max(maxtemp,y2);
                            }
                            case('sensor_3'):{
                                y3 = parseFloat(data[1]);
                                mintemp = Math.min(mintemp, y3);
                                maxtemp = Math.max(maxtemp,y3);
                            }
                    }
                }
                //alert(y);

            Highcharts.setOptions({
                global: {
                    useUTC: false
                }
            });
            var chart;
            $('#container').highcharts({
                chart: {
                    backgroundColor: 'rgba(255, 255, 255, 0.80)',
                    //type: 'spline',
                   animation: Highcharts.svg, // don't animate in old IE
                    //marginRight: 10,
                    events: {
                        load: function () {
                            // set up the updating of the chart each second
                            var series = this.series[0];
                            var series1 = this.series[1];
                            var series2 = this.series[2];
                            var series3 = this.series[3];
                            var series4 = this.series[4];
                            setInterval(function () {
                                var x = (new Date()).getTime(); // current time   
                                series.addPoint([x, y], true, true);
                                series1.addPoint([x, y1], true, true);
                                series2.addPoint([x, y2], true, true);
                                series3.addPoint([x, y3], true, true);
                               // series4.addPoint([x, y4], true, true);

                            }, 1000);
                        }
                    }
                },
                title: {
                    text: 'Real-time temperature'
                },
                xAxis: {
                    text:'/date',
                    type: 'datetime',
                    tickPixelInterval: 150
                },
                yAxis: {
                    text:'/centigrade',
                    max :maxtemp+0.3,
                    min :mintemp-0.5,
                    title: {
                        text: 'Value'
                    },
                    plotLines: [{
                        value: 0,
                        width: 1,
                        color: '#808080'
                    }]
                },

                series: [{
                    name: 'Average',
                    data: (function () {
                        // generate an array of random data
                        var data = [],
                            time = (new Date()).getTime(),
                            i;
                        for (i = -19; i <= 0; i++) {
                            data.push({
                                x: time + i * 1000,
                                y: 0
                            });
                        }
                        return data;
                    })()
                }, {
                    name: 'Sensor 1',
                    data: (function () {
                        // generate an array of random data
                        var data = [],
                            time = (new Date()).getTime(),
                            i;
                        for (i = -19; i <= 0; i++) {
                            data.push({
                                x: time + i * 1000,
                                y: 0
                            });
                        }
                        return data;
                    })()
                },

                {
                    name: 'Sensor 2',
                    data: (function () {
                        // generate an array of random data
                        var data = [],
                            time = (new Date()).getTime(),
                            i;
                        for (i = -19; i <= 0; i++) {
                            data.push({
                                x: time + i * 1000,
                                y: 0
                            });
                        }
                        return data;
                    })()
                },

                {
                    name: 'Sensor 3',
                    data: (function () {
                        // generate an array of random data
                        var data = [],
                            time = (new Date()).getTime(),
                            i;
                        for (i = -19; i <= 0; i++) {
                            data.push({
                                x: time + i * 1000,
                                y: 0
                            });
                        }
                        return data;
                    })()
                }]
            });
        }
        </script>
    </div>
<div id="info-content"></div>
</div>
    <input type="checkbox" id="menu" name="menu" class="menu-checkbox">
      <div class="menu">
        <label class="menu-toggle" for="menu"><span>Toggle</span></label>
        <ul>
          <li>
            <a href="http://localhost:3000">Home</a>
          </li>
          <li>
            <a href="http://localhost:3000/realtime">RealTime</a>
          </li>
          <li>
            <a href="http://localhost:3000/history">History</a>
          </li>
        </ul>
      </div>
    </div><!-- #wrapper -->
<!--***********************/-->
    <!--<div>
    <h2 align ="center">Historical Data</h2>  
    </div>-->
    
    
    
</body>
</html>
